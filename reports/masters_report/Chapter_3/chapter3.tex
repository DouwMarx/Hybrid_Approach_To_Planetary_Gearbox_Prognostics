%%
%%  Department of Electrical, Electronic and Computer Engineering
%%  MEng Dissertation / PhD Thesis - Chapter 3
%%  Copyright (C) 2011-2016 University of Pretoria.
%%

\chapter{Practical Investigative Study} \label{S:Practical}
This chapter documents three main pieces of work that were done in preparation for the authors' Masters in $2020$. The first section concerns the construction of a planetary gearbox test bench and some initial tests. In the second section, a hybrid prognostics method by \cite{Liao2016} is implemented using a Lithium-Ion battery dataset. The third section documents the progress made in constructing a lumped mass model by \cite{Chaari2006} for a planetary gearbox.

\section{Planetary Gearbox Test Bench}


A new Epicyclic Gearbox Test Bench was designed and built for the purpose of the experimental portion of this work. A multi-gearbox, epicyclic gearbox test facility, with load and speed control was constructed. Speed control is achieved through a 3kW DC motor with control circuitry. Load is provided on the system by a hydraulic gear pump, combined with an electro-hydraulic pressure control valve. \cite{Schon2005}

Torque transmission between each system module is achieved through rigid spider couplings? \cite{Schon2005}

Control circuitry consists of a sophisticated reconfigurable feedback control drive system, capable of using a shaft encoder mounted on the motor for feedback.








As part of the stated outcomes for the MSS 780 module, the author had to design and build a planetary gearbox test bench. The test bench should be capable of simulating wind turbine loading cases. This section documents the design process of the test bench and shows the results obtained from some preliminary tests.
\subsection{Design and construction of planetary gearbox test bench}
The Centre for Asset Integrity Management (CAIM) at the University of Pretoria has previously researched in the field of condition monitoring of planetary gearboxes \citep{Schon2005,Smidt2009}. As a result, the design was largely determined by the availability of previously used components. 

The planetary gearbox used is the Bonfiglioli $300-L 1·5.77·PC·V01 B·E$ (Specifications listed in Table \ref{t:Bonfiglioli}). Although this gearbox is an older variant of the one currently in production, parts are currently (2019) still available for it in South-Africa and occasionally manufactured abroad. 

% Mass and stiffness values are approximated and more accurate values for these parameters will have to be determined in the future. 

% Please add the following required packages to your document preamble:
% \usepackage{booktabs}
\begin{table}[H]
	\centering
	\caption{Bonfiglioli 300-L 1-5.77-PC-V01 B·E specifications}
	\label{t:Bonfiglioli}
	\begin{tabular}{@{}lll@{}}
		\toprule
		Symbol & Meaning & Value \\ \midrule
		$z_r$ & Number of ring gear teeth & $62$ \\
		$z_s$ & Number of sun gear teeth & $13$ \\
		$z_p$ & Number of planet gear teeth & $24$ \\
		&  &  \\
		$N$ & Number of planet gears & $3$ \\
		&  &  \\
		$R$& Gear Ratio  & $5.77$  \\\bottomrule
	\end{tabular}
\end{table}


Despite attempts at adapting the test bench layout (See Appendix\ref{A:testbench}) as used by \cite{Smidt2009} to be particularly suited testing planetary gearboxes ran in the speed up (wind turbine) configuration, the final test bench design has the same layout as the one used by \cite{Smidt2009}. This layout makes use of two planetary gearboxes in speed-down, speed-up configuration. This means that research can be conducted on planetary gearboxes in either the speed up and speed down configuration. Given that the test bench was used nearly $10$ years ago, a few components had to machined and bought and repairs were made to the hydraulic load system. 

Figure \ref{F:Overall} shows the overall drive train of the test bench. A $3kW$ DC motor drives a speed down gearbox that is connected to a speed-down gearbox. Seeing that the gearboxes have the same gear ratio, the output speed at the load is the same as the input speed at the motor. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{Chapter_3/Images_3/Overall}
	\caption{Overall drive train}
	\label{F:Overall}
\end{figure}

The numbered components in Figure \ref{F:Overall} are described as follows:

\begin{enumerate}
	\item Hydraulic load: A torque is applied to the gearbox output shaft using a hydraulic pump.
	\item Speed up gearbox: This gearbox is instrumented and monitored.
	\item Speed down gearbox: This gearbox is used to decrease the speed and increase the torque at the speed-up gearbox. This gearbox can however also be instrumented if research is done on planetary gearboxes used in the speed down configuration.
	\item $3kW$ DC motor: The encoded DC motor is capable of a maximum rotational speed of $3000RPM$. The motors' speed is controlled with a variable frequency drive that, in conjunction with the motor encoder, is capable of regulating the motor speed at a speed proportional to a $0-10V$ input voltage signal. The variable frequency drive is also capable of a $0-10V$ analogue output channel proportional to the motor torque, based on the motor current draw.
\end{enumerate}


Figure \ref{F:Instrumentation} shows the instrumentation used to take measurements on the speed-up gearbox.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{Chapter_3/Images_3/Instrumentation}
	\caption{Instrumentation}
	\label{F:Instrumentation}
\end{figure}

The numbered components in Figure \ref{F:Instrumentation} are described as follows:

\begin{enumerate}
	\item Flexible coupling: Transmits torque between components and addresses minor misalignment issues.
	\item Zebra tape tachometer: Used to measure the instantaneous rotational speed at the gearbox input and output. This allows for research on condition monitoring practices based on transmission error and can be used to verify that the DC motor speed is being controlled accurately. 
	\item \label{this_one} Ring gear: In the final test setup, the accelerometer will be bolted directly to the ring gear. 
	\item Uni-axial accelerometer: The accelerometer shown is attached to the gearbox using a magnet. This method of accelerometer mounting is not ideal and will be used only for preliminary tests. The accelerometer will ultimately be bolted to the ring gear as mentioned in point \ref{this_one}.
	\item Magnetic Pickup: Measured signal will show a 1x per revolution pulse as the shaft key passes the magnetic pickup. This signal will be use-full in time-synchronous averaging techniques and in differentiating between faults on the respective planet gears. An additional magnetic pickup (As used by \cite{Smidt2009}) can further be mounted inside a lubrication hole. This magnetic pickup would detect a threaded rod, threaded in directly behind a planet gear on the back of the planet carrier plate. The result will be a 3x per revolution pulse used to accurately determine the planet gear position. 
\end{enumerate}

All measured channels are sampled using the Quantum X data acquisition system that is capable of sampling rates of up to $96 kHz$. 


Figure \ref{F:Hydraulic} shows the hydraulic load system.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.35\textwidth}
		\includegraphics[width=1\textwidth]{Chapter_3/Images_3/Pump.jpg}
		\caption{Hydraulic pump}
		\label{F:Hydraulic_pump}
	\end{subfigure}
	~
	\begin{subfigure}{0.55\textwidth}
		\includegraphics[width=1\textwidth]{Chapter_3/Images_3/HeatExchange.jpg}
		\caption{Heat exchanger}
		\label{F:Heat_Exchange}
	\end{subfigure}
	
	\caption{Hydraulic load system}
	\label{F:Hydraulic}
\end{figure}

The hydraulic pump (Figure \ref{F:Hydraulic_pump}) is used as a load on the system. A solenoid valve on the heat exchanger (Figure \ref{F:Heat_Exchange}) controls the pressure at which the pump operates and as a result, the torque load. The heat exchanger has the function of circulating the oil through the system to cool it at the radiator. The hydraulic pump has a speed range of $650RPM - 5000RPM$. Seeing that the DC motor has a maximum rotational speed of $3000 RPM$, the RPM range in which the test setup can operate is $650 RPM - 3000 RPM$. The large speed range will make testing a large range of power dissipations possible for a certain torque (Wind turbine production can vary between $5-90\%$ of their rated capacity \citep{Zimroz2014}). The time constant of the response of the hydraulic remains to be determined experimentally.

The solenoid valve setting is controlled with a $0-10V$ signal. Both the load and speed can, therefore, be controlled from a computer to simulate non-stationary operating conditions as is typical in wind turbines. For time-varying load investigations, a control system that measures the current draw of the motor (as indication of torque) and adjusts the solenoid valve position to match a set torque load profile can be implemented.

Other additions that can be made to the test setup include a thermocouple to measure the oil temperature and an additional accelerometer for either measurement verification or studies into the use of multiple accelerometers.

%Praat oor die system reponse soos moontlik bespreek in die ou met die wierd franse naam
%Speak about the sampling frequency that will be used. 
%smidt says that Samuel Conroy and Pines 2004 gives a minimum samples per tooth kind of thing.

For crack length prediction investigations, artificial cracks will be introduced in the tooth root at the location of maximum bending stress(As determined by FEM). Instead of growing the cracks by running then in the gearbox, various crack lengths will be tested for short durations of time.
\cite{Ballarini1997} makes use of electro-discharge (EDM) machining to initiate cracks and then grows the cracks in an experimental setup. EDM is very precise and is capable of cutting thickness as small as $0.1mm$. However, EDM is very expensive and cannot be done in house at the University of Pretoria. If the cracks are introduced using EDM by an external machinist, a separate planet gear would ideally be required for each crack length tested. This will avoid having to take the gear to the machinist to enlarge te crack after each test and forcing the machinist to do a time-consuming part setup to align the cracks. Not only are the planet gears expensive, but the same planet gear should be used with different crack lengths to ensure that varying geometrical and material properties within a group of gears do not affect the results. If the cracks can be machined in house, the same planet gear can more be used for multiple crack lengths by using the same part setup. 

The author, therefore, suggests that time is invested in the design and construction of a gear crack cutting jig that makes use of one of the computer numerically controlled (CNC) machines at the University of Pretoria to cut cracks in gears. The jig would allow a user to cut an artificial crack using a standard 0.25mm scroll saw blade to a precise depth. Furthermore, the user would be able to increase the crack depth by securing the gear in the jig, changing the depth of cut in the CNC program and running the program.




\subsection{Frequency spectrum analysis}
A set of preliminary tests were conducted to gain an understanding of frequency components present in the vibration response. Due to a delay in waiting for some of the parts of the test setup, the full test setup as shown in Figure \ref{F:Overall} was not available at the time of testing. As a result, the measurements for these tests are taken on a gearbox in speed up configuration, under no load. The accelerometer is sampled at $9.6 kHz$. The gearbox is healthy with no faults introduced in the gear teeth.

Figure \ref{F:Freq_res} shows an example of the frequency spectrum obtained from the accelerometer measurements at a constant input rotational velocity of $550RPM$.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/FFT_Example}
		\caption{Frequency response of gearbox under no load}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/GMF_suppression}
		\caption{Section of frequency response}
		\label{F:Scaled}
	\end{subfigure}
	
	\caption{Frequency response of gearbox under no load}
	\label{F:Freq_res}
\end{figure}



The theoretical gear mesh frequency (GMF) is determined from equation \ref{eq:GMF} as listed in \cite{Miao2015}. 

\begin{equation}
f_{m}=\frac{z_{r} z_{s}}{z_{r}+z_{s}} \cdot f_{s}
\label{eq:GMF}
\end{equation}

where $z_{r}$ is the number of ring gear teeth, $z_{s}$ is the number of sun gear teeth and $f_{s}$ is the rotational frequency of the sun gear. Vertical lines are plotted on a scaled section of the frequency response in Figure \ref{F:Scaled} at the GMF and its harmonics for an input rotational speed of $550 RPM$. 

\cite{McNames2002} finds that the vibration signal will not have a frequency component at the GMF unless the number of ring gear teeth is an integer multiple of the number of planet gears. From the gearbox specifications in table \ref{t:Bonfiglioli} suppression of the GMF is expected. Figure \ref{F:Scaled} shows that the vibrations at $1\times GMF$ and $2 \times GMF$ are indeed suppressed. This result agrees with the calculations performed by \cite{Smidt2009} for this specific gearbox where it was found that the $1 \times GMF$ and $2 \times GMF$ would be suppressed.

Asymmetric sidebands due to  the modulation of the gear mesh frequency are also visible around the peaks at the GMF harmonics 

\subsection{Accelerometer position study}
Seeing that the accelerometer will ultimately be bolted to the gearbox and a tapped hole will have to be machined into the gearbox to do this, an investigation is performed on the proper positioning of the accelerometer. The magnetically mounted accelerometer is moved in $1mm$ increments along the casing of the gearbox. The accelerometer is sampled at $9600Hz$ for a total of $10$ seconds. 

This investigation aims to determine to what extent the measured response varies as the transmission path from the gear meshing point to the accelerometer varies. Figure \ref{F:Acc_pos} shows that as the accelerometer is gradually moved along the gearbox casing, it can be placed in line with the peak of the gear profile or in line with the trough of the gear profile or anywhere in between these two locations. The gear geometry is not the only factor that could make the choice of accelerometer position relevant.\cite{Smidt2009} determines that for the Bonfiglioli 300-L 1-5.77-PC-V01 B·E  gearbox used in this investigation, a given ring gear tooth will only mesh with either even or numbered planet gear teeth. Due to this phenomenon, \cite{Smidt2009} resorts to using multiple accelerometers to safely apply a time-synchronous averaging technique. The question to be answered is therefore if a sufficient amount of vibration information would be captured by fixing the accelerometer between two ring gear teeth (Thereby measuring both odd and even-numbered planet gear teeth) instead of attaching an accelerometer behind a even-numbered gear and a odd-numbered gear tooth respectively.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Chapter_3/Images_3/Acc_pos}
	\caption{Accelerometer position study}
	\label{F:Acc_pos}
\end{figure}


Figure \ref{F:All_data} shows the frequency response at each of the measured locations for two datasets. 


\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Waterfall100}
		\caption{100 RPM}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Waterfall500}
		\caption{500 RPM}
	\end{subfigure}
	
	\caption{Frequency response with distance from starting point}
	\label{F:All_data}
\end{figure}

A visual inspection suggests that the peaks in the frequency spectrum are at the same location for all positions where the accelerometer was placed. There are however variations in the amplitude of the peaks in the frequency spectrum at for instance $3\times GMF$. It is difficult to conclude whether there is a definitive trend in spectrum amplitude change at certain frequency bands with a change in accelerometer position.

As further analysis of the results, the coherence between the respective signals is calculated. The coherence of two signals can be used to determine to what extent the signals are similar. The coherence between two signals $x(t)$ and $y(t)$ can be calculated by


\begin{equation}
C_{x y}(f)=\frac{\left|G_{x y}(f)\right|^{2}}{G_{x x}(f) G_{y y}(f)}
\end{equation}

where $G_{x y}(f)$ is the cross-spectral density between the signals $x$ and $y$ and $G_{x x}(f)$ and $ G_{y y}(f)$ is the auto-spectral density of $x$ and $y$. The coherence of a signal with itself will have a value of one. On the other hand, if there is no agreement between signals, the coherence will be zero.

Figure \ref{F:Coherence_meaning} shows how the coherence between two signals can indicate similarities between their frequency spectra. When the coherence of vibration responses measured at the same rotational speed is considered, there is agreement between several frequency components in the spectrum (multiple peaks in the coherence spectrum). However, the coherence for acceleration signals measured at different rotational speeds show agreement at a smaller amount of frequencies. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Chapter_3/Images_3/Coherence_meaning}
	\caption{Coherence meaning}
	\label{F:Coherence_meaning}
\end{figure}

Factors such as noise, initial conditions, the peculiarities of magnetically mounted accelerometers and fluctuations in operating conditions lead to non-unity coherence values, even if the two signals being compared would have been measured at the same accelerometer location. The mean and standard deviation of the coherence over all samples is therefore calculated to gauge the significance of a particular coherence spectrum. A sample is defined as, for instance, the coherence between a signal measured at $1mm$ from the starting point with a signal measured at $8mm$ from the starting point. There were a total of 14 measurement locations. The coherence mean and the standard deviation was therefore based on $91$ samples: coherence of signal $1$ with signals $2-14$, coherence of signal $2$ with signals $1, 3-14$ and so on. 

Figure \ref{F:mean} shows the mean coherence spectrum over all signals. The shaded region (not to scale) indicates the standard deviation in coherence at a given frequency.  

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/100mean}
		\caption{100 RPM}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/500mean}
		\caption{500 RPM}
	\end{subfigure}
	
	\caption{Mean Coherence over all samples}
	\label{F:mean}
\end{figure}

The mean coherence takes a small value even though the signals are expected to be very similar. The maximum standard deviation over the frequency spectrum for all samples is rather small ($0.16$ for the 100RPM dataset and $0.19$ for the 500RPM dataset). This could indicate that there is no significant difference in the signals measured at different locations, considering that the standard deviation of coherence values across the spectrum of a typical signal is much larger than the maximum standard deviation in the mean coherence spectrum. 

To determine whether there is perhaps a noticeable trend in the coherence of signals and the distance between the locations where they were measured, the difference between the mean coherence and a specific sample is squared and then summed across the spectrum. This metric is henceforth referred to as the mean squared error (MSE). 

%Put in an equation here that illustrates this computation. 

This technique gives an indication of how different a given sample is from the mean. There is however no indication of whether this metric corresponds to different frequencies where peaks are present in the coherence spectrum, or if there is a difference in the amplitudes of the coherence at the same frequency. Also, a sample with coherence values generally larger than the mean could have the same mean squared error value as a sample with coherence values generally smaller than the mean coherence due to the squaring of the difference. 

Nonetheless, Figure \ref{F:Coherence_compare} shows some interesting results. The MSE for a pair of signals is indicated by a colour gradient.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Residual100imshow}
		\caption{100 RPM}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Residual500imshow}
		\caption{500 RPM}
	\end{subfigure}
	
	\caption{Mean squared error between sample mean coherence and the coherence of two measured signals}
	\label{F:Coherence_compare}
\end{figure}

Consider the lower triangular sections of Figure \ref{F:Coherence_compare}. Should there be an observable trend in the MSE of a column in this lower triangular section, it could indicate that the acceleration signal changes as the accelerometer is moved farther and farther away from its initial starting point. The reason for this is that, in a column, the one signal used in computing the coherence remains the same whilst the other signal is varied. Definitive trends in the MSE is perhaps not detectable when considering the matrix columns, but when the plot is viewed as a whole, nearly parallel, positive diagonal peaks and troughs are observed for both the $100$ RPM and $500$ RPM datasets. What is interesting, is that, in many cases, the vertical distance between these diagonal strips  (which would correspond to the actual distance between measurement points) is $6mm$ to $9mm$, which happens to be very close to the ring gear tooth root thickness of $7mm$. 

This result could mean that the measured response varies periodically as the transducer is moved on the gearbox casing due to the profile of the ring gear influencing the vibration transmission path. However, seeing that the cause of variation in MSE is unknown (Amplitude of frequency of coherence) conclusions cannot be drawn on whether the accelerometer position will have a meaning-full influence on the effectiveness of the measured signal to perform diagnostics or prognostics. Furthermore, this investigation will have to be extended by using a gearbox with a fault. This would aid in deciding on the accelerometer position, considering that a given ring gear tooth with mesh only with either an even-numbered or odd-numbered ring gear tooth. 





% However this does not prove that a accelerometer mounted at two different locations would diagnose a specific fault in the same way.


\section{RUL prediction of Lithium-ion batteries and its application to planetary gearbox monitoring} \label{S:Liao battery}

In this section, the hybrid approach introduced by \cite{Liao2016} is implemented. An attempt is made to replicate the battery RUL prediction results of \cite{Liao2016} subject to a series of simplifying assumptions. The goal of this section is to gain an understanding of the Bayesian state estimation problem and the hybrid method of \cite{Liao2016} and how it might apply to the prognostics of planetary gearboxes.

The hybrid method in question incorporates a physics-based method and two data-driven methods. The physics-based method is a battery degradation model with unknown parameters. The first data-driven model is used to infer the measurement model. The second data-driven model is used to predict future measurements.


%

%The system state $X_k$ is not always directly measurable. Therefore a measurement model is used to infer the system state form a measurement. The equation for the measurement model is given by 

%\begin{equation}
%Y_{k}=h\left(X_{k}\right)+v_{k}
%\end{equation} 

%Where $Y_k$ is the measurement taken by some transducer and $h$ represents the first data-driven model that is responsible for %relating the internal system state to the measurements that are made. The measurement noise is represented by $v_k$. 

%State tracking can be performed using a system degradation model given by 

%\begin{equation}
%X_{k}=f\left(X_{k-1}\right)+w_{k}
%\end{equation}

%where $w_{k}$ represents the system noise.

%For this particular hybrid methodology, the future measurements are predicted with an additional data-driven model $g$ as 

%\begin{equation}
%\hat{Y}_{k+1}=g\left(Y_{k}, Y_{k-1}, \ldots\right)+u_{k+1}
%\end{equation}

%where $u_k{k+1}$ represents the noise related to the predicted measurements. 

The dataset used is from the Prognostics CoE at NASA Ames \cite{Saha2007}. Lithium-Ion batteries were repeatedly charged and discharged whilst several parameters such as the capacity, internal resistance, voltage, and current curves were measured. 

Certain simplifications and modifications (see Appendix \ref{A:simplifications}) are made to the dataset and the models that the hybrid method comprises. The interest of this investigation is in the hybrid modeling framework and not necessarily the condition monitoring of Lithium-ion batteries. 

Figure \ref{F:Resistance} shows the increase in battery resistance with an increase in the number of cycles of the two batteries considered in this problem. The resistance of a battery can be viewed as the health metric or hidden state that gives and indication of the condition of the battery. The failure threshold or end of life for a battery is selected to be $0.14\Omega$. Figure \ref{F:Capacities} shows the capacities of the batteries that are measured at each cycle. The capacities are related to the battery resistances and give and indication of the hidden state (Resistance) of the battery. The capacities are used as a measurement in the state estimation problem. 

The physics-based model is an exponential decay model that is implemented with the use of a particle filter. The states evolve according to the relations 

\begin{equation}
\begin{array}{l}{Z_{k}=Z_{k-1} \exp \left(\Lambda_{k-1}\right)+w_{k}} \\ {\Lambda_{k}=\Lambda_{k-1}+\omega_{k}} \\ {X_{k}=\left[Z_{k} ; \Lambda_{k}\right]} \\ {Y_{k}=h\left(X_{k}\right)+v_{k}}\end{array}
\label{eq:decay}
\end{equation}

Where $Z$ is the internal battery resistance, $\Lambda$ is the decay parameter and $X_{k}$ is the system state. $w_{k}$, $\omega_{k}$  and $ v_{k}$ are zero mean Gaussian noise. 

Battery dataset $7$ is the dataset for with the RUL should be predicted.  The two data-driven models are built using the data from the battery dataset $5$. 

The physics-based model is 
%% Figure of resistance and capacitance here 

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Resistances}
		\caption{Battery resistance}
		\label{F:Resistance}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Capacities}
		\caption{Battery Capacity}
		\label{F:Capacities}
	\end{subfigure}
	
	\caption{Datasets used}
	\label{F:Dataset}
\end{figure}

The resistance and capacitance values of the batteries for a given cycle are plotted against each other in Figure \ref{F:RvC}. There is a strong correlation between the two variables and a measurement model can, therefore, be fit to the battery dataset $5$. The measurement model (Shown in Figure \ref{F:SVR}) is a support vector regression (SVR) model and makes up the first data-driven model for the hybrid approach. A simple linear model instead of the SVR model (As in \cite{Liao2016}) would also have worked in this case.  

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/RvsC}
		\caption{Resistance versus Capacities}
		\label{F:RvC}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Measurement_model}
		\caption{SVR measurement model fit}
		\label{F:SVR}
	\end{subfigure}
	
	\caption{Measurement model construction}
	\label{F:Measurement}
\end{figure}


\cite{Liao2016} makes use of a similarity-based prediction method to predict future capacity measurements. This constitutes the second data-driven model of the hybrid method. Seeing that the data-driven models in this investigation are built on a single dataset (Battery dataset $5$) a particle filter (separate from the particle filter used to infer the system state) is used to learn the parameters that govern an exponential decay model that attempts to predict the future capacity measurements. The exponential decay model is the same as the one in Equation \ref{eq:decay} 

The distribution for the learned decay parameter $\Lambda$ is shown in Figure \ref{F:decay}. An example of $50$ measurement capacity measurement predictions at cycle $70$ is shown in Figure \ref{F:preds}

Data driven future measurement prediction model \ref{F:Datadriven}

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Datadriven_decay_param1027}
		\caption{Learnt decay parameter distribution}
		\label{F:decay}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/DatadrivenPreds_edit}
		\caption{Example of measurement prediction paths at 70 cycles}
		\label{F:preds}
	\end{subfigure}
	
	\caption{Data driven measurement prediction}
	\label{F:Datadriven}
\end{figure}


The particle filter was initially coded from scratch but proved to run very inefficiently. The "Particles - Sequential Monte Carlo in python" package \citep{Chopin2019} was therefore used. This package runs more efficiently and supports parallelisation (the particle filter is considered to be an embarrassingly parallel task).

Figure \ref{F:Prediction} shows the RUL prediction results for the physics-based model (Particle filter without future measurement prediction) and the hybrid approach. The shaded region indicates one standard deviation from the mean.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Physics0925oldbutgood}
		\caption{Physics based model}
		\label{F:Phys}
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Hybrid0925oldbutgood}
		\caption{Hybrid Method}
		\label{F:Hyb}
	\end{subfigure}
	
	\caption{RUL prediction results}
	\label{F:Prediction}
\end{figure}

Figure \ref{F:Phys} does not make use of future measurement predictions. In this case, the particle filter learns the system parameters up until the current cycle. The RUL is then calculated by simply making predictions according to the system model using its latest parameters. There is, therefore, no further updates on the system model as the prediction steps are made to find the RUL. 

Figure \ref{F:Hyb} makes use of predicted measurement from the data-driven measurement prediction model. The parameters of the system, therefore, keeps being updated as predictions are being made. 

The results show that both methods are effective in estimating the $RUL$. The standard deviation around the mean RUL tends to decrease as the number of cycles to failure is decreased seeing that higher confidence is obtained in the model parameters after several cycles have passed. Furthermore, the amount of cycles that the model has to predict into the future (up until the failure threshold) is lower near the end of systems life. 

The hybrid method has mean predictions slightly closer to the actual RUL as compared to the standard physics-based particle filter. The main advantage of the hybrid approach that makes use of future measurement prediction is that the standard deviation in the RUL prediction is smaller. Small standard deviation in the RUL prediction does however not necessarily mean the model more is effective in estimating the RUL. A model could have very high confidence in its prediction even if the predictions are very far from the mean.

The system state initial conditions and the system and measurement noise have an important effect on the prediction accuracy and confidence of the model. The results presented in \ref{F:Prediction} have good rather RUL predictions from the start seeing that the starting resistance can be specified with a good amount of confidence. In this investigation, the system and measurement variance were adjusted until the predictions seem reasonable. However, this method of tuning the bootstrap filter is not feasible in practice. The purpose of the hybrid method is to make a prediction without the knowledge of run to failure data. A large contribution of the total success of a particle filter based physics model will, therefore, be dependent on how accurately the system and measurement noise can be determined without run-to-failure data. 

Consider the selected measurement noise for the hybrid approach. If this parameter is chosen to be too small, the predictions will be very strongly influenced by the predicted measurements. There would, therefore, have to be certainty that the predicted measurements are accurate. On the other hand, if the measurement noise variance is selected to be too large, the predicted measurements will not influence the prediction of health state significantly. In this case, a decrease in the RUL standard deviation over the system life might not be clearly observable when a good agreement between the system state evolution and the predicted measurements are present.

%note that physics based still refers to the use of a particle filter 
%Results could be improved by normalizing the data and tuning that parameters of the particle filter. Note that the results are perhaps not fair towards the normal method. It is easy to let it look bad comparitively.

%\begin{figure}[H]
%    \centering
%    \begin{subfigure}{0.49\textwidth}
%        \includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Physics1026}
%        \caption{Physics based model}
%    \end{subfigure}
%    ~
%    \begin{subfigure}{0.49\textwidth}
%        \includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Hybrid1026}
%        \caption{Hybrid Method}
%    \end{subfigure}

%    \caption{RUL prediction results}
%    \label{F:Prediction}
%\end{figure}

Table \ref{t:Compare} compares the battery prognostics problem with the planetary gearbox condition monitoring problem as a way to suggest that the hybrid method implemented by \cite{Liao2016} could apply to the planetary gearbox prognostics problem.

% Please add the following required packages to your document preamble:
% \usepackage{booktabs}
% \usepackage{graphicx}



\begin{table}[H]
	\centering
	\caption{Comparison between planetary gearbox prognostics and battery prognostics}
	\label{t:Compare}
	\begin{tabular}{|p{4cm}|p{6cm}|p{6cm}|}
		\hline
		&\textbf{Battery Prognostics}  & \textbf{Planetary gearbox prognostics} \\ \hline
		\textbf{Hidden state, Health indicator} & Internal Resistance [$\Omega$] & Root crack length [$mm$] \\\hline
		\textbf{Measured Variable} & Battery Capacity [Ah] & Acceleration features \\\hline
		\textbf{Data driven measurement model} & Resistance [$\Omega$] as input, Battery Capacity [Ah] as output & Root crack length [mm] as input, Acceleration features as output \\\hline
		\textbf{Data driven future measurement prediction model} & Predicts future capacity measurements & Predicts future acceleration feature measurements \\ \hline
	\end{tabular}
\end{table}




\section{Lumped mass modelling of planetary gearbox}

In this section, a $21$ DOF lumped mass model of a planetary gearbox \citep{Chaari2006} is programmed. Each component of the gearbox has two translational degrees of freedom and a rotational degree of freedom.

Figure \ref{F:model} shows a schematic of the lumped mass model. 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{Chapter_3/Images_3/chaari2006}
	\caption{Planetary gearbox model \citep{Chaari2006}}
	\label{F:model}
\end{figure}

The equations of motion of the lumped mass system is given by 

\begin{equation}
M \ddot{x}+\Omega_{c} G \dot{x}+\left[K_{b}+K_{e}(t)-\Omega_{c}^{2} K_{\Omega}\right] x=T+F(t)
\end{equation}

where 
\begin{itemize}
	\item $x$ is the vector of degrees of freedom
	\item $M$ is the mass matrix
	\item $\Omega_{c}$ is the rotational speed of the planet carrier
	\item $G$ is the gyroscopic matrix 
	\item $K_{b}$ is the bearing stiffness matrix
	\item $K_{e}(t)$ is the time varying mesh stiffness matrix
	\item $T$ is the vector of external torques
	\item $F(t)$ is the excitation force vector due to factors such as transmission error        
\end{itemize}

The expressions for each of the respective matrix indices are documented in \cite{Chaari2006}.

%For the chaari example we are running at $857 RPM$, The GMF is calculated as $300Hz$. the time varying mesh stiffness is approximated as a square wave. The TVMS can however be fed to the model as any arbitrary profile. A gear tooth crack can therefore artificially added to the model. An example of the time varying mesh stiffness depending on the contact ratio is shown in Figure \ref{F:TVMS}

The TVMS for the sun planet and planet ring interaction for a healthy gear system is approximated as a square wave. An example of the TVMS for the gearbox modelled in \cite{Chaari2006} running at $857RPM$ (GMF = $300Hz$) is shown in Figure \ref{F:TVMS}.


\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{Chapter_3/Images_3/TVMS}
	\caption{TVMS approximation}
	\label{F:TVMS}
\end{figure}


The overall stiffness matrix is given by

\begin{equation}
K = K_{b}+K_{e}(t)-\Omega_{c}^{2} K_{\Omega}.
\end{equation}

The overall mesh stiffness matrix is plotted in Figure \ref{F:Stiffness}. Since the mesh stiffens is time-varying the overall stiffness matrix will also be time-varying and there will be two cases of the stiffness matrix for a healthy gearbox under the square wave mesh stiffness assumption. 

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Total_stiff1.pdf}
		\caption{time = $0s$ }
	\end{subfigure}
	~
	\begin{subfigure}{0.49\textwidth}
		\includegraphics[width=1.1\textwidth]{Chapter_3/Images_3/Total_stiff2.pdf}
		\caption{time = $0.0025s$ }
	\end{subfigure}
	
	\caption{Stiffness matrix for model used by \cite{Chaari2006}}
	\label{F:Stiffness}
\end{figure}

Notice that there are non-negative terms on some of the off-diagonal elements of the stiffness matrix (from \cite{Chaari2006} equation 5). This results in a non-positive definite stiffness matrix. As a result, obtaining the solution of the lumped mass model through numerical integration, even with the addition of proportional damping, is very difficult.  

As a simple initial validation of the model, the eigenfrequencies of the model based on the average mesh stiffness is calculated by the eigenvalue problem. However, \cite{Chaari2006} does not explicitly state the gear mesh ratio which is required to determine the average mesh stiffness. The lumped mass model therefore still needs to be verified using \cite{Chaari2006} or \cite{Lin1999}.



